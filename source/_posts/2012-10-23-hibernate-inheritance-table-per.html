---
layout: post
comments: true
title: "Hibernate inheritance  table per subclass with different foreign key names"
date: 2012-10-23T14:34:00-07:00
categories:
 - SQL
 - Java
 - Hibernate
 - Inheritance
---

<div class='post'>
<br /><br />In one of the projects we were supposed to implement an inheritance in the db. The project based on Spring and Hibernate so we could pick one of the three inheritance methods. We decided to pick the inheritance of table for subclass. The problem as been discussed in many ways but it is not common that the names of the foreign keys are not equal to the name of the primary key.  <br /><br />
<!--more-->
<div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-6WpozGw9xfU/UIcD3wDG1bI/AAAAAAAAAHg/8xmqtt5UiqU/s1600/pobrane.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="368" src="https://1.bp.blogspot.com/-6WpozGw9xfU/UIcD3wDG1bI/AAAAAAAAAHg/8xmqtt5UiqU/s640/pobrane.png" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div>This is a diagram of a database that will be used in our example. As far as logic goes - we have an abstraction called <span style="font-family: 'Courier New', Courier, monospace;">ABSENCE</span> that can be either a recursive absence (<span style="font-family: 'Courier New', Courier, monospace;">REC_ABSENCE</span>) or a month recursive absence (<span style="font-family: 'Courier New', Courier, monospace;">MONTH_REC_ABSENCE</span>).<br /><br />The recursive absence and the month recursive absence are differing from the absence in terms of data being held more than in terms of the behavior.<br /><br />Of course from the logical point of view, this example can have little sense but it is just an example so don't focus on the business side.<br /><br /><b>Absence.java</b><br /><br /><pre class="brush:java">package pl.grzejszczak.marcin.entity;<br /><br />import java.util.Date;<br /><br />import javax.persistence.Column;<br />import javax.persistence.Entity;<br />import javax.persistence.GeneratedValue;<br />import javax.persistence.GenerationType;<br />import javax.persistence.Id;<br />import javax.persistence.Inheritance;<br />import javax.persistence.InheritanceType;<br />import javax.persistence.Table;<br />import javax.persistence.Temporal;<br />import javax.persistence.TemporalType;<br />import javax.persistence.Version;<br /><br />/**<br /> * Absence generated by hbm2java<br /> */<br />@Entity<br />@Table(name = "ABSENCE")<br />@Inheritance(strategy = InheritanceType.JOINED)<br />public class Absence implements java.io.Serializable {<br /> /**<br />  * <br />  */<br /> private static final long serialVersionUID = -4572952141587410338L;<br /> private int id;<br /> private int version;<br /> private Date startDate;<br /> private Date endDate;<br /><br /> public Absence() {<br /> }<br /><br /> @Id<br /> @Column(name = "ID", unique = true, nullable = false)<br /> @GeneratedValue(strategy = GenerationType.IDENTITY)<br /> public int getId() {<br />  return this.id;<br /> }<br /><br /> public void setId(int id) {<br />  this.id = id;<br /> }<br /><br /> @Version<br /> @Column(name = "VERSION", nullable = false)<br /> public int getVersion() {<br />  return this.version;<br /> }<br /><br /> public void setVersion(int version) {<br />  this.version = version;<br /> }<br /><br /> @Temporal(TemporalType.TIMESTAMP)<br /> @Column(name = "START_DATE", nullable = false, length = 23)<br /> public Date getStartDate() {<br />  return this.startDate;<br /> }<br /><br /> public void setStartDate(Date startDate) {<br />  this.startDate = startDate;<br /> }<br /><br /> @Temporal(TemporalType.TIMESTAMP)<br /> @Column(name = "END_DATE", length = 23)<br /> public Date getEndDate() {<br />  return this.endDate;<br /> }<br /><br /> public void setEndDate(Date endDate) {<br />  this.endDate = endDate;<br /> }<br />}<br /></pre><br /><b>RecursiveAbsence.java</b><br /><br />Note that you do not have to explicitly create an id field. You define it by means of an annotation <span style="font-family: 'Courier New', Courier, monospace;">@PrimaryKeyJoinColumn </span>with providing the name of the id column for the given entity (<span style="font-family: 'Courier New', Courier, monospace;">REC_ABSENCE_ID</span>) and the name of the column for the id it is referencing (<span style="font-family: 'Courier New', Courier, monospace;">ID</span> in the <span style="font-family: 'Courier New', Courier, monospace;">ABSENCE</span> table). <br /><br /><pre class="brush:java">package pl.grzejszczak.marcin.entity;<br /><br />import javax.persistence.Column;<br />import javax.persistence.Entity;<br />import javax.persistence.PrimaryKeyJoinColumn;<br />import javax.persistence.Table;<br /><br />/**<br /> * <br /> * Hibernate mapping strategy: Inheritance mapping: joined subclasses (table per<br /> * subclass)<br /> * <br /> */<br />@Entity<br />@Table(name = "REC_ABSENCE")<br />@PrimaryKeyJoinColumn(name = "REC_ABSENCE_ID", referencedColumnName = "ID")<br />public class RecursiveAbsence extends Absence implements java.io.Serializable {<br /><br /> /**<br />  * <br />  */<br /> private static final long serialVersionUID = 1L;<br /> private boolean isMonthly;<br /> private boolean isWeekly;<br /><br /> public RecursiveAbsence() {<br /> }<br /><br /> @Column(name = "isMONTHLY", nullable = false, precision = 1, scale = 0)<br /> public boolean getIsMonthly() {<br />  return this.isMonthly;<br /> }<br /><br /> public void setIsMonthly(boolean isMonthly) {<br />  this.isMonthly = isMonthly;<br /> }<br /><br /> @Column(name = "isWEEKLY", nullable = false, precision = 1, scale = 0)<br /> public boolean getIsWeekly() {<br />  return this.isWeekly;<br /> }<br /><br /> public void setIsWeekly(boolean isWeekly) {<br />  this.isWeekly = isWeekly;<br /> }<br />}<br /></pre><br /><b>MonthRecursiveAbsence.java</b><br /><br />Issue with the referencing of the column name as in the previous example.<br /><br /><pre class="brush:java">package pl.grzejszczak.marcin.entity;<br /><br />import javax.persistence.Column;<br />import javax.persistence.Entity;<br />import javax.persistence.PrimaryKeyJoinColumn;<br />import javax.persistence.Table;<br />import javax.persistence.Transient;<br /><br />@Entity<br />@Table(name = "MONTH_REC_ABSENCE")<br />@PrimaryKeyJoinColumn(name = "MONTH_ABSENCE_ID", referencedColumnName = "ID")<br />public class MonthRecursiveAbsence extends Absence implements java.io.Serializable {<br /><br /> /**<br />  * <br />  */<br /> private static final long serialVersionUID = 7844275381822579686L;<br /><br /> private Integer monthId;<br /><br /> public MonthRecursiveAbsence() {<br /> }<br /><br /> @Transient<br /> public MonthDefinitionEnum getMonth() {<br />  return MonthDefinitionEnum.getByKey(monthId);<br /> }<br /><br /> @Column(name = "MONTH_ID")<br /> public Integer getMonthId() {<br />  return monthId;<br /> }<br /><br /> public void setMonthId(Integer monthId) {<br />  this.monthId = monthId;<br /> }<br />}<br /></pre><br /><br /></div>
