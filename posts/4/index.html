<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>TOO MUCH CODING</title>
  <meta name="author" content="Marcin Grzejszczak">

  
  

  <!-- https://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://toomuchcoding.com/posts/4/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="TOO MUCH CODING" type="application/atom+xml">

  <!-- https://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://toomuchcoding.com/posts/4/">
  <meta property="og:title" content="TOO MUCH CODING">
  <meta property="og:description" content="A blog for coding addicts about Java, Groovy, Buzzword, Spring, Microservices, Buzzword">

  <script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/custom.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  

</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">TOO MUCH CODING</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/oss">OSS</a>
                </li>
                <li >
                    <a href="/abstracts">Abstracts</a>
                </li>
                <li >
                    <a href="/talks">Talks</a>
                </li>
                <li >
                    <a href="/publications">Publications</a>
                </li>
                <li >
                    <a href="/bio">Bio</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="https://toomuchcoding.com">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index" itemscope itemtype="https://schema.org/Blog">
    <meta itemprop="name" content="TOO MUCH CODING" />
    <meta itemprop="description" content="A blog for coding addicts about Java, Groovy, Buzzword, Spring, Microservices, Buzzword" />
    <meta itemprop="url" content="https://toomuchcoding.com" />
      
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-06-04T20:57:00+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2014/06/04/mockito-instant-code-repo-at-github/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2014/06/04/mockito-instant-code-repo-at-github/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2014/06/04/mockito-instant-code-repo-at-github/" itemprop="url">Mockito Instant Code Repo at Github</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
Hi!<br /><br />Since I was asked for the code to the<a href="https://www.packtpub.com/how-to-create-stubs-mocks-spies-using-mockito/book"> "Mockito Instant"</a> book a couple of times I decided to place it on Github. Here is the link - <a href="https://github.com/marcingrzejszczak/mockito-instant">https://github.com/marcingrzejszczak/mockito-instant</a>. Enjoy :)</div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-04-24T17:34:00+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2014/04/24/groovy-builder-ast-merged-to-groovy-core/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2014/04/24/groovy-builder-ast-merged-to-groovy-core/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2014/04/24/groovy-builder-ast-merged-to-groovy-core/" itemprop="url">Groovy Builder AST merged to Groovy Core!</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
<p dir=ltr>Hi! </p><p dir=ltr>Today it turned out that Paul King merged the Builder AST transform that based on my <a href="https://github.com/groovy/groovy-core/pull/341">PojoBuilder</a> to core of Groovy. So you will be able to use it when the new version of Groovy gets released.</p><p dir=ltr>You can take a look at the code here</p><p dir=ltr><a href="https://github.com/groovy/groovy-core/pull/389">https://github.com/groovy/groovy-core/pull/389</a></p><p dir=ltr>Many thanks go to <a href="https://solidsoft.wordpress.com"><b>Marcin Zaj&#261;czkowski</b></a> for his code review to the initial version.</p><p dir=ltr>It's not the biggest features in the world but anyway, enjoy :)</p></div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-03-21T09:19:00+01:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2014/03/21/warsaw-groovy-user-group-talk-ast/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2014/03/21/warsaw-groovy-user-group-talk-ast/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2014/03/21/warsaw-groovy-user-group-talk-ast/" itemprop="url">Warsaw Groovy User Group Talk - AST Transformations</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
Hi!<br /><br /><a href="https://www.youtube.com/watch?v=JdSCDEkX0Tw">Click here to go to the on-air hangout (in PL) regarding AST Transformations from my yesterday's presentation on Warsaw Groovy User Group</a></div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-02-19T23:39:00+01:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2014/02/19/warsaw-groovy-user-group-talk/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2014/02/19/warsaw-groovy-user-group-talk/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2014/02/19/warsaw-groovy-user-group-talk/" itemprop="url">Warsaw Groovy User Group talk</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
Hi!<br /><br />Since tomorrow I'm giving a talk on XML transformations in Groovy I'd like to publish the code that will be presented during the presentation. Check out the <a href="https://github.com/marcingrzejszczak/groovy-xml">Github repo</a>&nbsp;and the <a href="https://bitbucket.org/gregorin1987/groovy-xml">Bitbucket repository</a>.<br /><br />The presentation (in polish) can be found on <a href="https://www.youtube.com/watch?feature=player_detailpage&amp;v=MGu0HHzROxA#t=2109">youtube</a>.</div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-02-04T23:50:00+01:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2014/02/04/introduction-to-groovy-runtime/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2014/02/04/introduction-to-groovy-runtime/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2014/02/04/introduction-to-groovy-runtime/" itemprop="url">Introduction to Groovy runtime metaprogramming and AST transforms</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
Hi!<br /><br />I'm very happy to share my presentation regarding <b><i>Groovy metaprogramming and AST transforms</i></b>. The slides are available at <a href="https://www.slideshare.net/MarcinGrzejszczak/introduction-to-groovy-runtime-metaprogramming-and-ast-transforms">SlideShare</a>&nbsp;and the code is available at <a href="https://bitbucket.org/gregorin1987/too-much-coding/src/e5ab7c69ab7b2796075fd6f087fbf31346aa2d2b/Groovy/ast/?at=default">TooMuchCoding Bitbucket</a>&nbsp;and <a href="https://github.com/marcingrzejszczak/too-much-coding/tree/master/Groovy/ast">TooMuchCoding Github</a> repositories. If you have any problems with reading any part of the slides or sth just post a comment here and I'll tr to help you :)<br /><br />Enjoy!<br /><br /><br /><a name='more'></a>
<!--more-->
<br /><iframe allowfullscreen="" frameborder="0" height="356" marginheight="0" marginwidth="0" scrolling="no" src="https://www.slideshare.net/slideshow/embed_code/30820561" style="border-width: 1px 1px 0; border: 1px solid #CCC; margin-bottom: 5px; max-width: 100%;" width="427"> </iframe> <br /><div style="margin-bottom: 5px;"><strong> <a href="https://www.slideshare.net/MarcinGrzejszczak/introduction-to-groovy-runtime-metaprogramming-and-ast-transforms" target="_blank" title="Introduction to Groovy runtime metaprogramming and AST transforms">Introduction to Groovy runtime metaprogramming and AST transforms</a> </strong> from <strong><a href="https://www.slideshare.net/MarcinGrzejszczak" target="_blank">Marcin Grzejszczak</a></strong> <br /><br />I had a discussion with one of the readers regarding issues related to creating an AST transformation that would be used on classes (and not on scripts). Often you can see that such a transformation does not work for you even though it should. The problem might be that you have the AST transformation compiled in the same time toghether with the class that you annotated with AST transformation related annotation.<br /><br />What you have to remember about is that your AST transformation related classes have to be compiled prior to using (that's why you can often find that your AST transformation is working when you right click on your annotated class in your IDE (or Groovy console) and manually compile that particular class. That's because you compile that particular class when other classes have already been compiled. That's the very same scenario as with compiling a script that is using an AST transformation - first your tranformations are compiled and afterwards at runtime the script gets compiled.<br /><br />Please check the additional repository <a href="https://github.com/marcingrzejszczak/ast_examples">ast_examples</a> that consists of the same examples as in the <a href="https://github.com/marcingrzejszczak/too-much-coding">TooMuchCoding </a>repository together with an additional AST transformation that is set on a class.</div></div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-12-16T23:47:00+01:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2013/12/16/review-of-instant-mock-testing-with/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2013/12/16/review-of-instant-mock-testing-with/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2013/12/16/review-of-instant-mock-testing-with/" itemprop="url">Review of the Instant Mock Testing with PowerMock</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
Hi!<br /><br />Quite recently I was asked by Packt publishing to write a review of the book <a href="https://bit.ly/181GmFv">Instant Mock Testing with PowerMock</a> by&nbsp;Deep Shah. I have just managed to go through it and would like to share my thoughts :)<br /><br /><a name='more'></a>
<!--more-->
<h2>The layout</h2><br />I enjoyed the book's layout with clear separation of the discussed issues with level of expertise required for the given section. What was also really nice was the precise division of content into the introductory part and the concrete solution to the problem.<br /><h2>What I liked</h2><br /><ul><li>PowerMock is a very powerful tool that allows to test legacy code that was very badly written. On the other hand it can be tempting not to refactor existing code or even write bad code from the very beginning. So after this long introduction what I liked was that the author emphasised at the beginning of some chapters how a proper design should look like and that PowerMock breaks the rule</li><li>Names of test methods in the shown examples - they are very clear and teach good practices</li><li>Important parts of code are shown in bold - it attracts the reader and makes him focus immediately on the crucial elements</li><li>The examples clearly present the solution to the given problem</li><li>That I could learn about the PowerMock's <i>suppress</i> functionality :)</li><li>I had all the important PowerMock features in one place written in a concise and readable manner</li><li>Very thorough explanations for beginners in terms of adding PowerMock to Eclipse or IntelliJ</li><li>Introductory sections of each recipie (for example introducing the Active Record pattern)</li></ul><h2>What I didn't like</h2><div><ul><li>It's a very subjective opinion but I definitely prefer creating assertions through <span style="font-family: Courier New, Courier, monospace;">assertThat</span> methods with proper matchers instead of using <span style="font-family: Courier New, Courier, monospace;">assertEquals</span>, <span style="font-family: Courier New, Courier, monospace;">assertNull</span> etc.</li><li>Not sure if that many javadocs were needed in the examples - for me they blur the image</li><li>On one hand the tests seem clean but on the other there are test scenarios in which the implementation is being tested instead of behaviour (for example in stubbing/verifying private methods or in partial mocking with spies). Of course I understand that sometimes it's done if we really care about some method execution or for the sake of showing PowerMock capabilities but in some cases&nbsp;(e.g. Partial mocking with spies)&nbsp;the refactoring process is not clear to me.</li></ul><h2>Summary</h2></div><div>I really enjoyed the book&nbsp;<a href="https://www.packtpub.com/mock-testing-with-powermock/book">Instant Mock Testing with PowerMock</a>&nbsp;by&nbsp;Deep Shah because I like books related to computer science :) I'm pretty sure that someone that reads it will know about all the important PowerMock's features - Deep Shah did a good job here. I would however recommend that one reads the PowerMock's documentation first, especially the <a href="https://code.google.com/p/powermock/wiki/Motivation">when to use it part</a>&nbsp;since as authors state it:</div><blockquote class="tr_bq"><span style="background-color: white; font-family: arial, sans-serif; font-size: 13px; line-height: 16.390625px;">... PowerMock is mainly intended for people with expert knowledge in unit testing. Putting it in the hands of junior developers may cause more harm than good.</span></blockquote><div>Also there is good tutorial&nbsp;<a href="https://www.jayway.com/2013/03/05/beyond-mocking-with-powermock/">recommended by the PowerMock's authors</a>&nbsp;and if you are a Mockito user you can profit from the <a href="https://code.google.com/p/powermock/wiki/MockitoUsage13">Mockito usage at the project's wiki</a>&nbsp;(although the examples there are not that specific as in Deep Shah's book).</div><div><br /></div></div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-12-12T09:00:00+01:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2013/12/12/springs-primary-annotation-in-action/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2013/12/12/springs-primary-annotation-in-action/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2013/12/12/springs-primary-annotation-in-action/" itemprop="url">Spring's @Primary annotation in action</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
<br />Spring is a framework that never stops to amaze me. It's because of the fact that it offers plenty of different solutions that allow us, developers, to complete our tasks without writing millions of lines of code. Instead we are able to do the same in a much more readable, standardized manner. In this post I will try to describe one of its features that most likely is well known to all of you but in my opinion its importance is undervalued. The feature that I'll be talking about is the <span style="font-family: Courier New, Courier, monospace;"><a href="https://docs.spring.io/spring/docs/3.2.5.RELEASE/javadoc-api/org/springframework/context/annotation/Primary.html">@Primary</a></span> annotation.<br />
<!--more-->
<br /><a name='more'></a><br /><br /><h2>The problem</h2>On a couple of projects that I was working on we have come accross a common business problem - we had a point of entry to a more complex logic - some container, that would gather the results of several other processors into a single output (something like map-filter-reduce functions from the functional programming). To some extent it resembled the <a href="https://en.wikipedia.org/wiki/Composite_pattern">Composite</a> pattern. Putting it all together our approach was as follows:<br /><ol><li>We had a container that had an autowired list of processors implementing a common interface</li><li>Our container implemented the same interface as the elements of the autowired list</li><li>We wanted the client class that would use the container to have this whole processing work transparent - he is interesed only in the result</li><li>The processors have some logic (predicate) basing on which a processor is applicable to the current set of input data</li><li>The results of the processing were then combined into a list and then reduced to a single output</li></ol><div>There are numerous ways of dealing with this issue - I'll present one that uses Spring with the <span style="font-family: Courier New, Courier, monospace;">@Primary</span> annotation.</div><h2>The solution</h2>Let's start with defining how our use case will fit to the aforementioned preconditions. Our set of data is a Person class that looks as follows:<br /><br /><b>Person.java</b><br /><br /><pre class="brush:java">package com.blogspot.toomuchcoding.person.domain;<br /><br />public final class Person {<br /> private final String name;<br /> private final int age;<br /> private final boolean stupid;<br /><br /> public Person(String name, int age, boolean stupid) {<br />  this.name = name;<br />  this.age = age;<br />  this.stupid = stupid;<br /> }<br /><br /> public String getName() {<br />  return name;<br /> }<br /><br /> public int getAge() {<br />  return age;<br /> }<br /><br /> public boolean isStupid() {<br />  return stupid;<br /> }<br />}<br /><br /></pre>Nothing out of the ordinary. Now let us define the contract:<br /><br /><b>PersonProcessingService.java</b><br /><br /><pre class="brush:java">package com.blogspot.toomuchcoding.person.service;<br /><br />import com.blogspot.toomuchcoding.person.domain.Person;<br /><br />public interface PersonProcessingService {<br /> boolean isApplicableFor(Person person);<br /> String process(Person person);<br />}<br /></pre><br />As stated in the preconditions each implementaiton of the PersonProcessingService has to define two points of the contract :<br /><br /><ol><li>whether it is applicable for the current Person&nbsp;</li><li>how it processess a Person.</li></ol><br />Now let's take a look at some of the Processors that we have - I'll not post the code here cause it's pointless - you can check out the code later on <a href="https://github.com/marcingrzejszczak/too-much-coding/tree/master/Spring/Primary">Github</a> or on <a href="https://bitbucket.org/gregorin1987/too-much-coding/src/6c9b91a33f7d40032ff7c650d17bf60bd8c34625/Spring/Primary/?at=default">Bitbucket</a>. We have the following @Component annotated implementations of PersonProcessingService:<br /><ul><li>AgePersonProcessingService</li><ul><li>is applicable if Person's age is greater or equal 18</li><li>returns a String containing "AGE" as processing takes place - that's kind of silly but it's just a demo right? :)</li></ul><li>IntelligencePersonProcessingService</li><ul><li>is applicable if a Person is stupid</li><li>returns a String containing "STUPID" as processing takes place</li></ul><li>NamePersonProcessingService</li><ul><li>is applicable if a Person has a name</li><li>returns a String containing "NAME" as processing takes place</li></ul></ul><div>The logic is fairly simple. Now our container of PersonProcessingServices would want to iterate for a given Person over the processors, check if the current processor is applicable (filter) and if that is the case add the String that is a result of processing of a Person to the list of responses (map - a function converting a Person to a String) and finaly join those responses by a comma (reduce). Let's check it out how it's done:<br /><br /><b>PersonProcessingServiceContainer.java</b></div><div><br /><pre class="brush:java">package com.blogspot.toomuchcoding.person.service;<br /><br />import java.util.ArrayList;<br />import java.util.List;<br /><br />import org.apache.commons.lang.StringUtils;<br />import org.slf4j.Logger;<br />import org.slf4j.LoggerFactory;<br />import org.springframework.beans.factory.annotation.Autowired;<br />import org.springframework.context.annotation.Primary;<br />import org.springframework.stereotype.Component;<br /><br />import com.blogspot.toomuchcoding.person.domain.Person;<br /><br />@Component<br />@Primary<br />class PersonProcessingServiceContainer implements PersonProcessingService {<br /><br /> private static final Logger LOGGER = LoggerFactory.getLogger(PersonProcessingServiceContainer.class);<br /> <br /> @Autowired<br /> private List&lt;PersonProcessingService&gt; personProcessingServices = new ArrayList&lt;PersonProcessingService&gt;();<br /> <br /> @Override<br /> public boolean isApplicableFor(Person person) {<br />  return person != null;<br /> }<br /><br /> @Override<br /> public String process(Person person) {<br />  List&lt;String&gt; output = new ArrayList&lt;String&gt;();<br />  for(PersonProcessingService personProcessingService : personProcessingServices){<br />   if(personProcessingService.isApplicableFor(person)){<br />    output.add(personProcessingService.process(person));<br />   }<br />  }<br />  String result = StringUtils.join(output, ",");<br />  LOGGER.info(result);<br />  return result;<br /> }<br /><br /> public List&lt;PersonProcessingService&gt; getPersonProcessingServices() {<br />  return personProcessingServices;<br /> }<br />}<br /><br /><br /></pre>As you can see we have a container that is annotated with @Primary which means that if an implementation of the PersonProcessingService will have to be injected then Spring will pick the PersonProcessingServiceContainer to be injected. The cool thing is that we have an autowired list of PersonProcessingServices which means that all other implementations of that interface will get autowired there (the container will not autowire itself to the list!).<br /><br />Now let's check out the <a href="https://code.google.com/p/spock/">Spock tests</a> that prove that I'm not telling any lies. If you aren't using Spock already in your project then you should move it straight away :)<br /><br /><b>PersonProcessingServiceContainerIntegrationSpec.groovy</b><br /><br /><pre class="brush:java">package com.blogspot.toomuchcoding.person.service<br />import com.blogspot.toomuchcoding.configuration.SpringConfiguration<br />import com.blogspot.toomuchcoding.person.domain.Person<br />import org.springframework.beans.factory.annotation.Autowired<br />import org.springframework.test.context.ContextConfiguration<br />import spock.lang.Specification<br />import spock.lang.Unroll<br /><br />import static org.hamcrest.CoreMatchers.notNullValue<br /><br />@ContextConfiguration(classes = [SpringConfiguration])<br />class PersonProcessingServiceContainerIntegrationSpec extends Specification {<br /><br />    @Autowired<br />    PersonProcessingService personProcessingService<br />    <br />    def "should autowire container even though there are many implementations of service"(){       <br />        expect: <br />            personProcessingService instanceof PersonProcessingServiceContainer<br />    }<br />    <br />    def "the autowired container should not have itself in the list of autowired services"(){       <br />        expect: <br />            personProcessingService instanceof PersonProcessingServiceContainer<br />        and:<br />            !(personProcessingService as PersonProcessingServiceContainer).personProcessingServices.findResult {<br />                it instanceof PersonProcessingServiceContainer<br />            }<br />    }<br />    <br />    def "should not be applicable for processing if a person doesn't exist"(){<br />        given:<br />            Person person = null<br />        expect:<br />            !personProcessingService.isApplicableFor(person)<br />    }<br />    <br />    def "should return an empty result for a person not applicable for anything"(){<br />        given:<br />            Person person = new Person("", 17, false)<br />        when:<br />            def result = personProcessingService.process(person)<br />        then:<br />            result notNullValue()<br />            result.isEmpty()<br />    }<br /><br />    @Unroll("For name [#name], age [#age] and being stupid [#stupid] the result should contain keywords #keywords")<br />    def "should perform different processing depending on input"(){<br />        given:<br />            Person person = new Person(name, age, stupid)<br />        when:<br />            def result = personProcessingService.process(person)        <br />        then:<br />            keywords.every {<br />                result.contains(it)    <br />            }<br />        where:<br />            name  | age | stupid || keywords<br />            "jan" | 20  | true   || ['NAME', 'AGE', 'STUPID']<br />            ""    | 20  | true   || ['AGE', 'STUPID']<br />            ""    | 20  | false  || ['AGE']<br />            null  | 17  | true   || ['STUPID']<br />            "jan" | 17  | true   || ['NAME']<br />    }<br />}<br /><br /></pre></div><div>The tests are pretty straight forward:<br /><ol><li>We prove that the autowired field is in fact our container - the PersonProcessingServiceContainer.</li><li>Then we show that we can't find an object in the collection of autowired implementations of the PersonProcessingService, that is of PersonProcessingServiceContainer type</li><li>In the next two tests we prove that the logic behind our processors is working</li><li>Last but not least is the Spock's finest - the where clause that allows us create beautiful paramterized tests.</li></ol><h2>Per module feature</h2><div>Imagine the situation in which you have an implementation of the interface that is defined in your core module.</div><div><br /><pre class="brush:java">@Component<br />class CoreModuleClass implements SomeInterface {<br />...<br />}<br /><br /></pre></div><div>What if you decide in your other module that has the dependence to the core module that you don't want to use this CoreModuleClass and want to have some custom logic wherever the SomeInterface is autowired? Well - use @Primary!<br /><pre class="brush:java">@Component<br />@Primary<br />class CountryModuleClass implements SomeInterface {<br />...<br />}<br /></pre><br />In that way you are sure that wherever the SomeInterface has to be autowired it will be your CountryModuleClass that will be injected in the field.<br /><h2>Conclusion</h2></div></div>In this post you could see how to<br /><br /><ul><li>use the @Primary annotation to create a composite like container of interface implementations</li><li>use the @Primary annotation to provide a per module implementation of the interface that will take precedence over other @Components in terms of autowiring</li><li>write cool Spock tests :)</li></ul><h2>The code</h2>You can find the code presented here on&nbsp;<a href="https://github.com/marcingrzejszczak/too-much-coding/tree/master/Spring/Primary">Too Much Coding's Github repository</a>&nbsp;or on&nbsp;<a href="https://bitbucket.org/gregorin1987/too-much-coding/src/6c9b91a33f7d40032ff7c650d17bf60bd8c34625/Spring/Primary/?at=default">Too Much Coding's Bitbucket repository</a>.</div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-09-30T22:10:00+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2013/09/30/review-of-getting-started-with-guava/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2013/09/30/review-of-getting-started-with-guava/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2013/09/30/review-of-getting-started-with-guava/" itemprop="url">Review of the Getting Started with Guava book</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
<span style="font-family: inherit;"><span style="color: black;">Hi!</span></span><span style="font-family: inherit;"><br /></span><br /><span style="font-family: inherit;">I didn't have much time to write posts recently (beacuse of work and my book <a href="https://www.packtpub.com/how-to-create-stubs-mocks-spies-using-mockito/book">"Mockito Instant"</a>) but&nbsp;</span><span style="font-family: inherit;">I came across Bill Bejeck's book entitled <a href="https://www.packtpub.com/getting-started-with-google-guava/book">"Getting Started with Guava"</a>. After having read it I decided that I will try also to blog about computer science related books. So without any futher ado let's move to the review :)</span><br />
<!--more-->
<span style="font-family: inherit;"></span><br /><a name='more'></a><br /><span style="font-family: inherit;"><span style="color: black;">To begin with I really enjoyed the book's structure – one can see that the author had a clear view of the book: introduction to the functionality, its presentation with examples and a short review. By keeping such a fixed structure the reader wasn't surprised by the content in each of the chapters what made reading even more pleasant.</span></span><br /><span style="font-family: inherit;"><span style="color: black;"><br /></span></span><span style="font-family: inherit;"><span style="color: black;">Let's move quickly through the book content chapter by chapter.&nbsp;</span></span><br /><span style="font-family: inherit;"><span style="color: black;"><br /></span></span><span style="font-family: inherit;"><span style="color: black;"></span></span><br /><b>Basic Guava Utilities</b><br /><div><br /></div><span style="font-family: inherit;"><span style="color: black;">First of all you will be able to increase your knowledge about joining and splitting operations on collections by means of the Joiner and Splitter classes - no more unnecessary writing of loops! You will be able also to learn how to operate on Strings using&nbsp;</span></span><span class="Apple-tab-span" style="white-space: pre;"> </span> CharMatcher, Charsets,&nbsp;Strings which often is extremely tidious and produces a lot of boilerplate code. Next you will be able to learn about Preconditions - you won't have to write those cascades of if's in terms of defensive programming. Instead how about checking a condition and throw a runtime exception? To end with the author shows how to use Guava's utility classes to create implementation of toString, hashCode and compareTo methods.<br /><div><br /></div><div><div><b>Functional Programming with Guava</b></div></div><div><br /></div><div>In this chapter the author shows how to introduce some functional approach to your Object oriented Java code with the Function, Predicate and Supplier interfaces and their corresponding utility classes Functions, Predicates and Suppliers.</div><div><br /></div><div><div><b>Working with Collections</b></div></div><div><br /></div><div>Since the Guava library emerged from issues related with collection manipulation the author could show the best examples in this chapter. You will learn about the Collections,&nbsp;FluentIterables, and Iterables utility classes. The author also mentions the Range class that you can use to represent boundaries. You will also be able to find information on other types of collections such as Bimaps (maps that aside from being navigated in the standard key to value way can be navigated from values to keys), Tables (replacement for map of maps), Multimaps (values are collections). There is also a part of the chapter related to the Ordering class that fives you additional posisbilities of working with Comparators.</div><div><br /></div><div><b>Concurrency</b></div><div><br /></div><div>The issue of concurrency is a very difficult issue as such. Guava can assist you in this difficult subject in a number of was that the author depicts: the Monitor class (version of a Mutex) can help you provide the serial access to part of your code, the Futures utility class to work with Future instances and many more cool solutions ;)</div><div><br /></div><div><b>Guava Cache</b></div><div><br /></div><div>The author shows several ways of creating caches, showing their statistics and how to configure them. You will also be able to learn how to register listeners for different cashe related types of events.&nbsp;</div><div><br /></div><div><b>The Event Bus</b></div><div><br /></div><div>The author shows how to subscribe to events by using the Google Guava's Event Bus. What I really liked about this chapter was the presentation of the reason for incorporating it in a project (loose coupling) and a sample of using it in a Spring based application.</div><div><br /></div><div><b>Working with Files</b></div><div><br /></div><div>You will be able to find presentations of the utility classes and helpful solutions related to working with IO such as Files, CharStreams, ByteStreams, Readers , Writers the Closer class (elegant way of ensuring that the Closeable instance gets properly closed). The author presents the concept behind source and sinks too. So if you work a lot with files you will find plenty of cool stuff here.</div><div><br /></div><div><b>Odds and Ends</b></div><div><br /></div><div>Useful classes related to creating hash codes, working with Throwables and creating your applications in a null safe way.</div><div><br /></div><span style="font-family: inherit;"><span style="color: black;">I would never say that I know every aspect of Guava but I tend to use a lot of its functionalities at work. That's why I was really curious about the level of details that the author wanted to present in his book and whether I would find some really interesting details of the library that I wasn't aware of. What I found in the book was very satisfactory for me because although I was already familliar with the majority of the presented examples and functionalities, still I found plenty of those „little things” that I can use to improve my code and remove more boilerplate.</span></span><span style="font-family: inherit;"><span style="color: black;"><br /></span></span><br /><span style="font-family: inherit;"><span style="color: black;">Speaking of which, what I really wanted to look at from the very beginning where the code samples showing how cool and helpful Guava really is. Being a true fan of unit testing I was very happy to see that the author put a lot of effort in those examples - the majority of functionalities were described by means of unit tests and showing some real life situations.</span></span><span style="font-family: inherit;"><span style="color: black;"><br /></span></span><br /><span style="font-family: inherit;"><span style="color: black;">To sum it up I think that Bill Bejeck has put a tremendous effort in writing his book and he has done the job exceptionally well. I would recommend „Getting Started with Guava” for both newbies and experts – for sure both of these groups will be very satisfied.</span></span></div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-08-28T10:20:00+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2013/08/28/mockito-instant-my-book-has-finally/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2013/08/28/mockito-instant-my-book-has-finally/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2013/08/28/mockito-instant-my-book-has-finally/" itemprop="url">Mockito Instant - my book has finally been published!</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
I am very pleased to announce that my book about Mockito entitled "Mockito Instant" has finally been published! You can buy it at&nbsp;<a href="https://www.packtpub.com/how-to-create-stubs-mocks-spies-using-mockito/book">Packt Publishing online shop</a>.</div>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        










<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-08-09T14:39:00+02:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
           | <a href="/articles/2013/08/09/injecting-test-doubles-in-spring-using/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="https://toomuchcoding.com/articles/2013/08/09/injecting-test-doubles-in-spring-using/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/articles/2013/08/09/injecting-test-doubles-in-spring-using/" itemprop="url">Injecting Test Doubles in Spring using Mockito and BeanPostProcessors</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><div class='post'>
<br />I'm pretty sure that if you have ever used Spring and are familliar with unit testing, you have encountered a problem related to injecting mocks / spies (Test Doubles) in the Spring's application context which you wouldn't want to modify. This article presents an approach how to solve this issue using Spring's components.<br />
<!--more-->
<br /><a name='more'></a><h2>Project structure</h2>Let's start with the project structure:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-24owAXPWDec/UgS1olJ038I/AAAAAAAABlA/O90115z1yIk/s1600/Project+structure.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://1.bp.blogspot.com/-24owAXPWDec/UgS1olJ038I/AAAAAAAABlA/O90115z1yIk/s320/Project+structure.jpg" width="207" /></a></div><br />As usual to present a problem I'm trying to show a very simple project structure. The approach that I'm about to show could show more benefits if I made the problem more extensive as we had in our project:<br /><br /><ul><li>we had dozens of interfaces and implementations autowired to lists</li><li>we wanted to perform some functional tests basing on the existing Spring application context&nbsp;</li><li>we wanted to verify that for certain input conditions some specific implementation would have their methods executed&nbsp;</li><li>we wanted to stub database access.</li></ul><br />In this example we have a <span style="font-family: Courier New, Courier, monospace;">PlayerService</span> that gets a <span style="font-family: Courier New, Courier, monospace;">Player </span>using a <span style="font-family: Courier New, Courier, monospace;">PlayerWebService</span>. We have an applicationContext that simply defines packages for autowiring:<br /><br /><b>applicationContext.xml</b><br /><br /><pre class="brush:xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;beans xmlns="https://www.springframework.org/schema/beans"<br />       xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance"<br />       xmlns:context="https://www.springframework.org/schema/context"<br />       xsi:schemaLocation="https://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans-3.0.xsd<br />                           https://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context-3.0.xsd"&gt;<br /><br />    &lt;context:component-scan base-package="com.blogspot.toomuchcoding"/&gt;<br /><br />&lt;/beans&gt;<br /><br /></pre>Then we have our very simple model:<br /><br /><b>Player.java</b><br /><br /><pre class="brush:java">package com.blogspot.toomuchcoding.model;<br /><br />import java.math.BigDecimal;<br /><br />/**<br /> * User: mgrzejszczak<br /> * Date: 08.08.13<br /> * Time: 14:38<br /> */<br />public final class Player {<br />    private final String playerName;<br />    private final BigDecimal playerValue;<br /><br />    public Player(final String playerName, final BigDecimal playerValue) {<br />        this.playerName = playerName;<br />        this.playerValue = playerValue;<br />    }<br /><br />    public String getPlayerName() {<br />        return playerName;<br />    }<br /><br />    public BigDecimal getPlayerValue() {<br />        return playerValue;<br />    }<br />}<br /><br /></pre><br />the implementation of the <span style="font-family: Courier New, Courier, monospace;">PlayerService </span>that uses <span style="font-family: Courier New, Courier, monospace;">PlayerWebService </span>to retrieve data regarding the <span style="font-family: Courier New, Courier, monospace;">Player</span>:<br /><br /><b>PlayerServiceImpl.java</b><br /><br /><pre class="brush:java">package com.blogspot.toomuchcoding.service;<br /><br />import com.blogspot.toomuchcoding.model.Player;<br />import org.slf4j.Logger;<br />import org.slf4j.LoggerFactory;<br />import org.springframework.beans.factory.annotation.Autowired;<br />import org.springframework.stereotype.Service;<br /><br />/**<br /> * User: mgrzejszczak<br /> * Date: 08.06.13<br /> * Time: 19:02<br /> */<br />@Service<br />public class PlayerServiceImpl implements PlayerService {<br />    private static final Logger LOGGER = LoggerFactory.getLogger(PlayerServiceImpl.class);<br /><br />    @Autowired<br />    private PlayerWebService playerWebService;<br /><br />    @Override<br />    public Player getPlayerByName(String playerName) {<br />        LOGGER.debug(String.format("Logging the player web service name [%s]", playerWebService.getWebServiceName()));<br />        return playerWebService.getPlayerByName(playerName);<br />    }<br /><br />    public PlayerWebService getPlayerWebService() {<br />        return playerWebService;<br />    }<br /><br />    public void setPlayerWebService(PlayerWebService playerWebService) {<br />        this.playerWebService = playerWebService;<br />    }<br />}<br /><br /></pre><br />the implementation of the PlayerWebService that is a provider of data (in this scenario we are simulating awaiting for response):<br /><br /><b>PlayerWebServiceImpl.java</b><br /><br /><pre class="brush:java">package com.blogspot.toomuchcoding.service;<br /><br />import com.blogspot.toomuchcoding.model.Player;<br />import org.slf4j.Logger;<br />import org.slf4j.LoggerFactory;<br />import org.springframework.stereotype.Service;<br /><br />import java.math.BigDecimal;<br /><br />/**<br /> * User: mgrzejszczak<br /> * Date: 08.08.13<br /> * Time: 14:48<br /> */<br />@Service<br />public class PlayerWebServiceImpl implements PlayerWebService {<br />    private static final Logger LOGGER = LoggerFactory.getLogger(PlayerWebServiceImpl.class);<br />    public static final String WEB_SERVICE_NAME = "SuperPlayerWebService";<br />    public static final String SAMPLE_PLAYER_VALUE = "1000";<br /><br />    @Override<br />    public String getWebServiceName() {<br />        return WEB_SERVICE_NAME;<br />    }<br /><br />    @Override<br />    public Player getPlayerByName(String name) {<br />        try {<br />            LOGGER.debug("Simulating awaiting time for a response from a web service");<br />            Thread.sleep(5000);<br />        } catch (InterruptedException e) {<br />            LOGGER.error(String.format("[%s] occurred while trying to make the thread sleep", e));<br />        }<br />        return new Player(name, new BigDecimal(SAMPLE_PLAYER_VALUE));<br />    }<br />}<br /><br /></pre>Perhaps the project structure and the methods are not one of the most brilliant you have ever seen but I wanted to keep it simple to present the problem ;)<br /><br /><h2>The problem</h2>So what actually is the problem? Let us assume that we want our autowired <span style="font-family: Courier New, Courier, monospace;">PlayerWebServiceImpl</span> to be a Spy that we can verify. What is more you don't want to actually change anything in the <span style="font-family: Courier New, Courier, monospace;">applicationContext.xml</span> - you want to use the current version of the Spring context.<br /><br />With mocks it's easier since you can define in your XML file (using Mockito factory method) your bean as a mock to override the original implementation just like this:<br /><br /><pre class="brush:xml">    &lt;bean id="playerWebServiceImpl" class="org.mockito.Mockito" factory-method="mock"&gt;<br />        &lt;constructor-arg value="com.blogspot.toomuchcoding.service.PlayerWebServiceImpl"/&gt;<br />    &lt;/bean&gt;<br /></pre><br />What about the Spy? It's more problematic since in order to create a Spy you need an already existing object of the given type. In our example we have some autowiring going on so we would have to first create a spring bean of the <span style="font-family: Courier New, Courier, monospace;">PlayerWebService </span>type (Spring would have to wire all its dependencies) and then wrap it around with<span style="font-family: Courier New, Courier, monospace;"> Mockito.spy(...)</span> and only then would it have to be wired somewhere else... It's getting very complicatied doesn't it?<br /><h2>The solution</h2>You can see that the problem is not that trivial to be solved. An easy way to fix it however is to use native Spring mechanisms - BeanPostProcessors. You can check my article about how to create a <a href="https://toomuchcoding.blogspot.com/2012/10/spring-beanpostprocessor-for-specified.html">Spring BeanPostProcessor for a specified type</a>&nbsp;- we'll be using it in this example.<br /><br />Let's start with checking the test class:<br /><br /><b>PlayerServiceImplTest.java</b><br /><br /><pre class="brush:java">package com.blogspot.toomuchcoding.service;<br /><br />import com.blogspot.toomuchcoding.model.Player;<br />import org.junit.Test;<br />import org.junit.runner.RunWith;<br />import org.springframework.beans.factory.annotation.Autowired;<br />import org.springframework.test.context.ContextConfiguration;<br />import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;<br /><br />import java.math.BigDecimal;<br /><br />import static org.hamcrest.CoreMatchers.is;<br />import static org.junit.Assert.assertThat;<br />import static org.mockito.BDDMockito.doReturn;<br />import static org.mockito.Mockito.verify;<br /><br />/**<br /> * User: mgrzejszczak<br /> * Date: 08.06.13<br /> * Time: 19:26<br /> */<br />@RunWith(SpringJUnit4ClassRunner.class)<br />@ContextConfiguration("classpath:testApplicationContext.xml")<br />public class PlayerServiceImplTest {<br /><br />    public static final String PLAYER_NAME = "Lewandowski";<br />    public static final BigDecimal PLAYER_VALUE = new BigDecimal("35000000");<br /><br />    @Autowired<br />    PlayerWebService playerWebServiceSpy;<br /><br />    @Autowired<br />    PlayerService objectUnderTest;<br /><br />    @Test<br />    public void shouldReturnAPlayerFromPlayerWebService(){<br />        //given<br />        Player referencePlayer = new Player(PLAYER_NAME, PLAYER_VALUE);<br />        doReturn(referencePlayer).when(playerWebServiceSpy).getPlayerByName(PLAYER_NAME);<br /><br />        //when<br />        Player player = objectUnderTest.getPlayerByName(PLAYER_NAME);<br /><br />        //then<br />        assertThat(player, is(referencePlayer));<br />        verify(playerWebServiceSpy).getWebServiceName();<br />        assertThat(playerWebServiceSpy.getWebServiceName(), is(PlayerWebServiceImpl.WEB_SERVICE_NAME));<br />    }<br /><br /><br />}<br /><br /></pre>In this test we want to mock retrieval of <span style="font-family: Courier New, Courier, monospace;">Player </span>from the <span style="font-family: Courier New, Courier, monospace;">PlayerWebService </span>(let's assume that normally it would try to send a request to the outside world - and we wouldn't want that to happen in our scenario) and test that our <span style="font-family: Courier New, Courier, monospace;">PlayerService </span>returns the <span style="font-family: Courier New, Courier, monospace;">Player </span>that we provided in the method stub and what is more we want to perform verification on the Spy that the method <span style="font-family: Courier New, Courier, monospace;">getWebServiceName()</span> has been executed and that it has a very precisely defined return value. In other words we wanted to stub the method <span style="font-family: Courier New, Courier, monospace;">getPlayerByName(...)</span> and wanted to perform verification of the spy by checking the&nbsp;<span style="font-family: Courier New, Courier, monospace;">getWebServiceName()</span><span style="font-family: inherit;">method.</span><br /><br />Let's check the test context:<br /><br /><b>testApplicationContext.xml</b><br /><br /><pre class="brush:xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;beans xmlns="https://www.springframework.org/schema/beans"<br />       xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance"<br />       xsi:schemaLocation="https://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd"&gt;<br /><br />    &lt;import resource="applicationContext.xml"/&gt;<br />    &lt;bean class="com.blogspot.postprocessor.PlayerWebServicePostProcessor" /&gt;<br />&lt;/beans&gt;<br /></pre><br />The test context is very small since it's importing the current <span style="font-family: Courier New, Courier, monospace;">applicationContext.xml</span> and creating a Bean that is the key feature in this example - the <span style="font-family: Courier New, Courier, monospace;">BeanPostProcessor</span>:<br /><br /><b>PlayerWebServicePostProcessor.java</b><br /><br /><pre class="brush:java">package com.blogspot.postprocessor;<br /><br /><br />import com.blogspot.toomuchcoding.processor.AbstractBeanPostProcessor;<br />import com.blogspot.toomuchcoding.service.PlayerWebService;<br /><br />import static org.mockito.Mockito.spy;<br /><br />/**<br /> * User: mgrzejszczak<br /> * Date: 07.05.13<br /> * Time: 11:30<br /> */<br />public class PlayerWebServicePostProcessor extends AbstractBeanPostProcessor&lt;PlayerWebService&gt; {<br />    public PlayerWebServicePostProcessor() {<br />        super(PlayerWebService.class);<br />    }<br /><br />    @Override<br />    public PlayerWebService doBefore(PlayerWebService bean) {<br />        return spy(bean);<br />    }<br /><br />    @Override<br />    public PlayerWebService doAfter(PlayerWebService bean) {<br />        return bean;<br />    }<br />}<br /><br /></pre>The class is extending the <span style="font-family: Courier New, Courier, monospace;">AbstractBeanPostProcessor </span>that implements the <a href="https://static.springsource.org/spring/docs/3.2.x/javadoc-api/org/springframework/beans/factory/config/BeanPostProcessor.html">BeanPostProcessor </a>interface. The logic behind this class is to register the Class for which one wants to perform some actions either before initialization (<a href="https://static.springsource.org/spring/docs/3.2.x/javadoc-api/org/springframework/beans/factory/config/BeanPostProcessor.html#postProcessBeforeInitialization(java.lang.Object, java.lang.String)">postProcessBeforeInitialization</a>) or after initialization of the bean (<a href="https://static.springsource.org/spring/docs/3.2.x/javadoc-api/org/springframework/beans/factory/config/BeanPostProcessor.html#postProcessAfterInitialization(java.lang.Object, java.lang.String)">postProcessAfterInitialization</a>). The AbstractBeanPostProcessor is well explained in my post&nbsp;<a href="https://toomuchcoding.blogspot.com/2012/10/spring-beanpostprocessor-for-specified.html">Spring BeanPostProcessor for a specified type</a>&nbsp;but there is one slight change - in my old post we were allowed by the abstraction to perform some actions on the bean without the possibility of returning a wrapper or a proxy on the bean.<br /><br />As you can see in the case of <span style="font-family: Courier New, Courier, monospace;">PlayerWebServicePostProcessor</span>&nbsp;before initialization we are creating a Spy using <span style="font-family: Courier New, Courier, monospace;">Mockito.spy(...)</span> method. In this way we create a factory hook on the intialization of beans of given type - it's as simple as that. This method will be executed for all the classes that implement the <span style="font-family: Courier New, Courier, monospace;">PlayerWebService&nbsp;</span>interface.<br /><h2>Other possibilities</h2><div>While checking out current solutions to this problem I have encountered the <a href="https://bitbucket.org/kubek2k/springockito/wiki/Home">Springockito library</a>&nbsp;by Jakub Janczak.</div><div><br /></div><div>I haven't been using this so I don't know what are (if there are any ;) ) production issues related to this library but it seems really nice and intuitive - great job Jakub! Still, you become dependent on the external library whereas in this example I've shown how to deal with the issue using Spring.</div><h2>Summary</h2><div>In this post I've shown how to</div><div><ul><li>create mocks for existing beans using XML Spring configuration</li><li>create a BeanPostProcessor implementation that performs logic for a given class of beans</li><li>return Spy (you could also return a Mock) for the given class of bean</li></ul></div><div>Now let's move through the Prons and Cons of my approach:</div><div><b><br /></b></div><div><b>Advantages</b></div><div><ul><li>you use Spring native mechanism to create Test Doubles for your beans</li><li>you are not required to add any additional external dependencies</li><li>if you use the <span style="font-family: Courier New, Courier, monospace;">AbstractBeanPostProcessor</span> you have very little changes to implement</li></ul></div><div><b>Disadvantages</b></div><div><ul><li>you have to be familliar with internal Spring architecture (that it uses BeanPostProcessors) - but is it a disadvantage? ;) - in fact if you use the&nbsp;<span style="font-family: Courier New, Courier, monospace;">AbstractBeanPostProcessor</span>&nbsp;&nbsp;you don't have to be familliar with it - you just have to provide the class type and actions to happen before and after initialization.</li><li>it's less intuitive than annotations like in&nbsp;the&nbsp;<a href="https://bitbucket.org/kubek2k/springockito/wiki/Home">Springockito library</a></li></ul></div><h2>Sources</h2>The sources are available at <a href="https://bitbucket.org/gregorin1987/too-much-coding/src/0e7f9ad4eb4c1d2500562c3634253e26fc1e3a0e/Unit%20Testing/Mockito%20-%20Injecting%20Test%20Doubles%20in%20Spring?at=default">TooMuchCoding BitBucket repository</a> and <a href="https://github.com/marcingrzejszczak/too-much-coding/tree/master/Unit%20Testing/Mockito%20-%20Injecting%20Test%20Doubles%20in%20Spring">TooMuchCoding Github repository</a>.<br /><br /></div>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/posts/5">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next"><a href="/posts/3">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
        <section>
  <h1>About Me</h1>
  <p><img src="/images/ja.jpeg" style="float:left;margin:5px;border-width:0px;width:100%;height:100%"/>
  Co-author of <a href="https://smarttesting.pl">SmartTesting</a>, author of <a href="https://learning.oreilly.com/videos/hands-on-guide-to/9780135598436">Hands-On Guide to Spring Cloud Contract: Creating Consumer-Driven Contracts to Leverage Contract Tests and Improve Your Code</a> and co-author of <a href="https://bit.ly/appliedCD">Applied Continuous Delivery Live Lessons</a>. Co-founder of the Warsaw Groovy User Group, <a href="https://www.meetup.com/Warsaw-Cloud-Native-Meetup/">Warsaw Cloud Native Meetup</a> and the <a href="https://www.diverseit.io">DiverseIT</a> initiative. Author of <a href="https://www.packtpub.com/application-development/instant-mockito">"Mockito Instant"</a> and <a href="https://www.packtpub.com/application-development/mockito-cookbook">"Mockito Cookbook"</a> books.
  </p>

  <p>
  Lead of <a href="https://cloud.spring.io/spring-cloud-sleuth/">Spring Cloud Sleuth</a>, <a href="https://cloud.spring.io/spring-cloud-contract/">Spring Cloud Contract</a> and <a href="https://spring.io/blog/2018/11/13/spring-cloud-pipelines-to-cloud-pipelines-migration">Cloud Pipelines</a> projects at <a href="https://spring.io">VMware</a>
  </p>

  <p><a href="https://github.com/marcingrzejszczak">Github profile</a></p>

  <p><a href="https://twitter.com/MGrzejszczak">Twitter: @MGrzejszczak</a></p>

  <p><a href="https://www.goodreads.com/author/show/7284553.Marcin_Grzejszczak">Goodreads account</a></p>
</section>

      </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2021 - Marcin Grzejszczak<br>
  <small>
      <span class="credit">Powered by <a href="https://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'toomuchcoding';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr.js"></script>


  </body>
</html>
